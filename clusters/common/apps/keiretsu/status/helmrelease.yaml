---
apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: gatus
spec:
  interval: 30m
  chart:
    spec:
      chart: gatus
      version: 1.4.2 
      sourceRef:
        kind: HelmRepository
        name: twin
        namespace: flux-system
  install:
    remediation:
      retries: 3
  upgrade:
    cleanupOnFail: true
    remediation:
      retries: 3
  values:
    image:
      tag: latest
    envFrom:
      - secretRef:
          name: gatus
    config:
      alerting:
        discord:
          webhook-url: "$${discord-webhook-url}"
      endpoints:
        - name: kirito
          group: tailscale
          url: https://kirito.ai:11434
          interval: 60s
          client:
            insecure: true
          conditions:
            - "[STATUS] == 401"
          alerts:
            - type: discord
              send-on-resolved: true