---
apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: harbor
spec:
  interval: 30m
  chart:
    spec:
      chart: harbor
      version: "*"
      sourceRef:
        kind: HelmRepository
        name: harbor
        namespace: flux-system
  values:
    updateStrategy:
      type: Recreate
    harborAdminPassword: "${DEFAULT_PASSWORD}"
    externalURL: https://${LOCATION}-harbor.keiretsu.ts.net
    expose:
      type: clusterIP
      tls: 
        enabled: false
        certSource: none
    core:
      configureUserSettings: |
        {
          "auth_mode": "oidc_auth",
          "oidc_name": "tsidp",
          "oidc_endpoint": "https://ottawa-idp.keiretsu.ts.net",
          "oidc_client_id": "26aeab2c54a0ac76131471bedbac3d96",
          "oidc_client_secret": "578fffa3df43d9bf9d948b1d9ca721cb980faa70cb15d6cdb3e8e3ff47f73f89",
          "oidc_scope": "openid,profile,email",
          "oidc_verify_cert": true,
          "oidc_auto_onboard": true,
          "oidc_user_claim": "preferred_username",
          "oidc_groups_claim": "groups"
        } 