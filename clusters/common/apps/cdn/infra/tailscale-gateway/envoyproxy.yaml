---
apiVersion: gateway.envoyproxy.io/v1alpha1
kind: EnvoyProxy
metadata:
  name: cdn
spec:
  provider:
    type: Kubernetes
    kubernetes:
      envoyDeployment:
        patch:
          type: StrategicMerge
          value:
            spec:
              template:
                spec:
                  automountServiceAccountToken: true
        replicas: 3
        pod:
          annotations:
            tailcar.rajsingh.info/inject: "true"
            tailcar.rajsingh.info/tailnet: keiretsu-labs-github
      envoyService:
        annotations:
          tailscale.com/hostname: cdn-envoy-gateway
          tailscale.com/proxy-group: common-ingress
        loadBalancerClass: tailscale
---
apiVersion: gateway.envoyproxy.io/v1alpha1
kind: EnvoyProxy
metadata:
  name: ${LOCATION}
spec:
  provider:
    type: Kubernetes
    kubernetes:
      envoyDeployment:
        replicas: 3
      envoyService:
        annotations:
          tailscale.com/hostname: ${LOCATION}-envoy-gateway
          tailscale.com/proxy-group: common-ingress
        loadBalancerClass: tailscale
