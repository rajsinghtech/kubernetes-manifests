apiVersion: kubevirt.io/v1
kind: VirtualMachineInstanceReplicaSet
metadata:
  name: openwrt-vm
spec:
  replicas: 1
  selector:
    matchLabels:
      vm: openwrt
  template:
    metadata:
      labels:
        vm: openwrt
    spec:
      domain:
        devices:
          interfaces:
            - name: default
              masquerade: {}
            - name: test1
              bridge: {}
          disks:
            - name: openwrt-install
              disk:
                bus: virtio
        machine:
          type: ""
        resources:
          requests:
            memory: 256Mi
      networks:
        - name: default
          pod: {}
        - name: test1
          multus: # Multus network as default
            # default: true
            networkName: bridge-router
      volumes:
        - name: openwrt-install
          persistentVolumeClaim:
            claimName: openwrt-install

  # dataVolumeTemplates: # Automatically a PVC of size 2Gi is created
  #   - metadata:
  #       name: openwrt-install-disk
  #     spec:
  #       pvc:
  #         accessModes:
  #           - ReadWriteOnce
  #         resources:
  #           requests:
  #             storage: 2Gi
  #       source:
  #         http:
  #           url: https://mirrors.cicku.me/openwrt/releases/23.05.3/targets/x86/64/openwrt-23.05.3-x86-64-generic-ext4-combined.img.gz